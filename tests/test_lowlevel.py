#!/usr/bin/env pytest

from py_abieos import _abieos


def test_decode_ship_block(ship_abi, abieos_ctx):
    encoded_block_hex = (
        'e71d5a470000000000ea30550000000f426521e456687e7012ec37220dc6835c8fcd74e91'
        '9386ca32dac74d5303542cb90721d0226e10ec09fafb83c8390685199481e39a42cd12845'
        'e8814a62ec8d0ccaef2a21ffcccdfb417c08bb2c40bc83a7b6af4615cc3c1bd4319b3a958'
        '700000000010100000015104208d7b7aa7e100003a21294cf229605ef75ba4c75456a827b'
        '40dc611a843a37d6a5c91ad38b421635d055ae67d2eb983b0002dd8202fc4e1efe58f3fe5'
        '4191497c96cab7fcd3c4f9c22ac7367b4d354020dcc8021a2f160aaa241000261096f8f70'
        '563e1e3b0fda936a94b957caa60b209b214dca6690b7847051c9e860268d0a5d733055000'
        '25183a9a93702bf4071149220310289ececa7ac41147f1140baa32e5d96a281adc0299f2e'
        '1e9d3055000234626a8ab821e6ac3d2f7db5846f07ae66e57e861d8a3f550ff0f3c605bdc'
        '913901dbd5925ea30550003254fadc5dc48c3269b61362103da76aa5ff3902f3425983a0f'
        '93f34943660492500f75d16425315500027a29a1c9896e3bcb73b2515190953c96b3559f1'
        'a065eaaae938ea18175b7ec0f80683c3ebbe9d67400027c7388090f588e77fb29426b9b7e'
        '484cdeae7d385ad1f48af8a196ff00a0270e406f85f1603a9d8100022dbbfafe230112ebc'
        '2754e84649f743806f65beba09e94c6dfd51799664b47ee80695479526632a20002a2ad00'
        'b124ad4abf28ac33c4fd523a6262ee62bd8a9f4079360ab2b475d55262a0129dc8244ca3c'
        'a0003f08f1745a004f01bf387b23fe75c879b9b1a5ffc7c81dd16f5c24caf5d0d320710a2'
        '3934324ca3ca000299f03526e26c2aab82c15494192b39c1a9e0e79a787d42dcc031648d6'
        'bf805f950cf54ea324ca3ca000316df5be18b4ab25f94ce96196a704b67211a852b10f5b0'
        '4991b0d27b061a11551092bbc9484ca3ca0003c6061290f1a8e30a3468596f3bd01c006d0'
        'a42bbeeca6ad33b287559e6c20a3b508f93c6494ca3ca000311739eac79593cbb4b66f858'
        '9a849e2a0a8f8a7f341491fd767267ca4691c8d6002ff55c4d4ca3ca00038dd0ce1c4e115'
        '88403fcff7af0d4dc3610271c3dcbb0dad61dde43ced95ca4298055a2136a4ca3ca0003c9'
        '4e8c3b04696ee217b84f5b97ad3070c70a7727da5854e85c0f16880cf7dd6c7015339e6e4'
        'ca3ca000378828b10d7860ec05a1cf47470713702713ca742e83da8b9e5e9524ebb4dfbdd'
        '70d5d6144db371cc0002302d29c8a3aa078dd02f27eadc806decb0b15f83526eeac2b4cd1'
        'afe5da5e65860a2d25f4db571cc0003daeded528da9013a399dd59929be3196549b643bf4'
        '8576c67513380901698e9f80a96a28eba432dd00030459df9a25dc52e1340f82eb5a7eefc'
        '41e6e6b4636f0fd12c487ce47c8fbc78300001f5e2c27cc0240062a0131ea43e1d950ccc8'
        'b70b9d9b5930225551f7693bf0ec710b90a46abe1a0aa98f9fa1bcb907eaa125e75462bde'
        'e3079458905961e87fa11020094090000170101001f4f187016bdcb22f5d96f0e61788ebe'
        'c97e0628be1a4adeda58222f1dfedce1b76d753957fa6f311fdfd9609ef5e893e91af0bbe'
        '221bf9f4ee7dd8ef4f481943b0000628f521a5c614207d5ba2f00000000010000000000ea'
        '3055c08fca86a9a8d2d401a09867fd4896876200000000a8ed323230a09867fd48968762a'
        '09867fd4896876268e77c060000000004544c4f5300000028c87c060000000004544c4f53'
        '00000000006e09000017010100206d519b49c5cd1e6e7bad69bc1edc37ec7ac4e20677d42'
        'b8c35b81d1f4b07cbaf5439263bae4675dffc6cb3d74cab87008c36508376061a1ab948ef'
        '261809cda10000628f521a5c614207d5ba2f00000000010000000000ea3055c08fca86a9a'
        '8d2d401a09863f6499bbe6900000000a8ed323230a09863f6499bbe69a09863f6499bbe69'
        'd0ef80000000000004544c4f53000000d0ef80000000000004544c4f530000000000'
    )
    encoded_block_bytes = bytes.fromhex(encoded_block_hex)
    cid = 0
    _abieos.abieos_set_abi(abieos_ctx, cid, ship_abi)

    decoded_block = _abieos.abieos_hex_to_json(
        abieos_ctx,
        cid,
        'signed_block',
        encoded_block_hex
    )
    result = _abieos.abieos_json_to_bin(
        abieos_ctx,
        cid,
        'signed_block',
        decoded_block
    )

    assert result

    assert abieos_ctx.result_bin == encoded_block_bytes
